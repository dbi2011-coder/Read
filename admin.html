<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø£Ø©</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container" id="loginScreen">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
        <input type="password" id="adminPass" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ">
        <button id="btnLogin">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div class="container hidden" id="setupScreen">
        <h2>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©</h2>
        
        <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©:</label>
        <select id="surahNum"></select>
        
        <label>Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø¢ÙŠØ©:</label>
        <input type="number" id="startVerse" value="1">
        
        <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©:</label>
        <select id="amountType">
            <option value="verses">Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª Ù…Ø­Ø¯Ø¯</option>
            <option value="quarter">Ø±Ø¨Ø¹ ÙˆØ¬Ù‡</option>
            <option value="half">Ù†ØµÙ ÙˆØ¬Ù‡</option>
            <option value="full">ÙˆØ¬Ù‡ ÙƒØ§Ù…Ù„</option> </select>
        
        <input type="number" id="amountValue" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª (ÙÙŠ Ø­Ø§Ù„ Ø§Ø®ØªØ±Øª Ø¢ÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø©)">
        
        <button id="btnStart">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
    </div>

    <div class="container hidden" id="dashboardScreen">
        <div style="display: flex; justify-content: space-between;">
            <span id="waitingCount">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 0</span>
            <button class="btn-danger" id="stopBookingBtn">ØªØ­Ù…ÙŠÙ„...</button>
        </div>

        <button class="big-circle-btn" id="btnNext">Ø§Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â©</button>
        
        <div id="currentReaderDisplay" style="margin: 20px 0; font-weight: bold; color: var(--primary-color);">
            ...
        </div>

        <button class="btn-secondary" onclick="document.getElementById('readersTableContainer').classList.toggle('hidden')">
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø±Ø¦Ø§Øª ğŸ“‹
        </button>
        
        <div id="readersTableContainer" class="hidden">
            <table id="readersTable">
                <thead>
                    <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ø¢ÙŠØ§Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initSession, nextReader, toggleBooking, deleteReader, makeUrgent, listenToData, checkAdminPass, getSurahList } from './logic.js';

        // --- ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ± ---
        const surahSelect = document.getElementById('surahNum');
        const surahs = getSurahList();
        
        for (let i = 1; i < surahs.length; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.text = `${i}. ${surahs[i]}`;
            surahSelect.appendChild(option);
        }
        surahSelect.value = 2; // Ø§Ù„Ø¨Ù‚Ø±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹

        // --- Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ø¯Ø¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ®ØªØ± "Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª" ---
        document.getElementById('amountType').addEventListener('change', (e) => {
             const input = document.getElementById('amountValue');
             input.style.display = (e.target.value === 'verses') ? 'block' : 'none';
        });

        // 1. Login
        document.getElementById('btnLogin').onclick = () => {
            const pass = document.getElementById('adminPass').value;
            if (checkAdminPass(pass)) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('setupScreen').classList.remove('hidden');
            } else {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±Ù…Ø²');
            }
        };

        // 2. Start Session
        document.getElementById('btnStart').onclick = () => {
            const surah = document.getElementById('surahNum').value;
            const startV = document.getElementById('startVerse').value;
            const type = document.getElementById('amountType').value;
            const val = document.getElementById('amountValue').value || 5;
            
            initSession(surah, startV, type, val);
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');
        };

        // 3. Dashboard Buttons
        document.getElementById('btnNext').onclick = nextReader;
        document.getElementById('stopBookingBtn').onclick = toggleBooking;
        window.callDelete = (index) => deleteReader(index);
        window.callUrgent = (index) => makeUrgent(index);

        // 4. Live Updates
        listenToData((state) => {
            document.getElementById('dashboardScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden'); 
            document.getElementById('setupScreen').classList.add('hidden');

            const btnStop = document.getElementById('stopBookingBtn');
            btnStop.innerText = state.isBookingStopped ? "ÙØªØ­ Ø§Ù„Ø­Ø¬Ø²" : "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø¬Ø²";
            btnStop.style.backgroundColor = state.isBookingStopped ? "#4CAF50" : "#d32f2f";

            const remaining = (state.queue ? state.queue.length : 0) - (state.currentReaderIndex + 1);
            document.getElementById('waitingCount').innerText = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining > 0 ? remaining : 0}`;

            if (state.queue && state.currentReaderIndex >= 0 && state.currentReaderIndex < state.queue.length) {
                const curr = state.queue[state.currentReaderIndex];
                document.getElementById('currentReaderDisplay').innerText = `ØªÙ‚Ø±Ø£ Ø§Ù„Ø¢Ù†: ${curr.name} (${curr.verses})`;
            } else {
                document.getElementById('currentReaderDisplay').innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡...";
            }

            const tbody = document.querySelector('#readersTable tbody');
            tbody.innerHTML = '';
            if(state.queue) {
                state.queue.forEach((reader, index) => {
                    if (index >= state.currentReaderIndex) {
                        const row = `<tr>
                            <td>${reader.name}</td>
                            <td>${index + 1}</td>
                            <td>${reader.verses}</td>
                            <td>
                                ${index > state.currentReaderIndex ? `<button class="btn-danger" style="padding:5px" onclick="window.callDelete(${index})">Ø­Ø°Ù</button>` : 'Ø­Ø§Ù„ÙŠØ§Ù‹'}
                                ${index > state.currentReaderIndex + 1 ? `<button style="padding:5px" onclick="window.callUrgent(${index})">Ù…Ø³ØªØ¹Ø¬Ù„Ø©</button>` : ''}
                            </td>
                        </tr>`;
                        tbody.innerHTML += row;
                    }
                });
            }
        });
    </script>
</body>
</html>
