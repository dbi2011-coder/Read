<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø£Ø© (Ø§Ù„Ù…Ø´Ø±ÙØ©)</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .hidden { display: none !important; }
        .btn-reset { background-color: #607d8b; margin-top: 20px; font-size: 14px; padding: 10px; }
    </style>
</head>
<body>

    <div class="container" id="loginScreen">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙØ©</h2>
        <input type="password" id="adminPass" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (1234)">
        <button onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div class="container hidden" id="setupScreen">
        <h2>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©</h2>
        <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø© (Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©):</label>
        <select id="surahNum"></select>
        <label>Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø¢ÙŠØ©:</label>
        <input type="number" id="startVerse" value="1">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©:</label>
        <select id="amountType" onchange="toggleAmountInput()">
            <option value="verses">Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª Ù…Ø­Ø¯Ø¯</option>
            <option value="quarter">Ø±Ø¨Ø¹ ÙˆØ¬Ù‡ (ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ 8 Ø¢ÙŠØ§Øª)</option>
            <option value="half">Ù†ØµÙ ÙˆØ¬Ù‡ (ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ 15 Ø¢ÙŠØ©)</option>
            <option value="full">ÙˆØ¬Ù‡ ÙƒØ§Ù…Ù„ (ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ 29 Ø¢ÙŠØ©)</option>
        </select>
        <input type="number" id="amountValue" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª">
        <button onclick="handleStartSession()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
    </div>

    <div class="container hidden" id="dashboardScreen">
        <div style="display: flex; justify-content: space-between;">
            <span id="waitingCount">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 0</span>
            <button class="btn-danger" id="stopBookingBtn" onclick="handleToggleBooking()">ØªØ­Ù…ÙŠÙ„...</button>
        </div>

        <button class="big-circle-btn" onclick="handleNextReader()">Ø§Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â©</button>
        
        <div id="currentReaderDisplay" style="margin: 20px 0; font-weight: bold; color: #00796b;">...</div>

        <button class="btn-secondary" onclick="toggleTable()">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø±Ø¦Ø§Øª ğŸ“‹</button>
        
        <div id="readersTableContainer" class="hidden">
            <table id="readersTable">
                <thead>
                    <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ù…ÙˆØ¶Ø¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <button class="btn-reset" onclick="resetSession()">ğŸ”„ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <script>
        const STORAGE_KEY = 'quran_queue_offline_v3';
        const surahNames = [
            "", "Ø§Ù„ÙØ§ØªØ­Ø©", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", "Ø§Ù„Ø£Ù†ÙØ§Ù„", "Ø§Ù„ØªÙˆØ¨Ø©", "ÙŠÙˆÙ†Ø³", "Ù‡ÙˆØ¯", "ÙŠÙˆØ³Ù", "Ø§Ù„Ø±Ø¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø§Ù„Ø­Ø¬Ø±", "Ø§Ù„Ù†Ø­Ù„", "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", "Ø§Ù„ÙƒÙ‡Ù", "Ù…Ø±ÙŠÙ…", "Ø·Ù‡", "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø­Ø¬", "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", "Ø§Ù„Ù†ÙˆØ±", "Ø§Ù„ÙØ±Ù‚Ø§Ù†", "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù…Ù„", "Ø§Ù„Ù‚ØµØµ", "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", "Ø§Ù„Ø±ÙˆÙ…", "Ù„Ù‚Ù…Ø§Ù†", "Ø§Ù„Ø³Ø¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨", "Ø³Ø¨Ø£", "ÙØ§Ø·Ø±", "ÙŠØ³", "Ø§Ù„ØµØ§ÙØ§Øª", "Øµ", "Ø§Ù„Ø²Ù…Ø±", "ØºØ§ÙØ±", "ÙØµÙ„Øª", "Ø§Ù„Ø´ÙˆØ±Ù‰", "Ø§Ù„Ø²Ø®Ø±Ù", "Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", "Ø§Ù„Ø£Ø­Ù‚Ø§Ù", "Ù…Ø­Ù…Ø¯", "Ø§Ù„ÙØªØ­", "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", "Ù‚", "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", "Ø§Ù„Ø·ÙˆØ±", "Ø§Ù„Ù†Ø¬Ù…", "Ø§Ù„Ù‚Ù…Ø±", "Ø§Ù„Ø±Ø­Ù…Ù†", "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ù„Ø­Ø¯ÙŠØ¯", "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", "Ø§Ù„Ø­Ø´Ø±", "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©", "Ø§Ù„ØµÙ", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", "Ø§Ù„ØªØºØ§Ø¨Ù†", "Ø§Ù„Ø·Ù„Ø§Ù‚", "Ø§Ù„ØªØ­Ø±ÙŠÙ…", "Ø§Ù„Ù…Ù„Ùƒ", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø­Ø§Ù‚Ø©", "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", "Ù†ÙˆØ­", "Ø§Ù„Ø¬Ù†", "Ø§Ù„Ù…Ø²Ù…Ù„", "Ø§Ù„Ù…Ø¯Ø«Ø±", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", "Ø§Ù„Ù†Ø¨Ø£", "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", "Ø¹Ø¨Ø³", "Ø§Ù„ØªÙƒÙˆÙŠØ±", "Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±", "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", "Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚", "Ø§Ù„Ø¨Ø±ÙˆØ¬", "Ø§Ù„Ø·Ø§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºØ§Ø´ÙŠØ©", "Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¨Ù„Ø¯", "Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø¶Ø­Ù‰", "Ø§Ù„Ø´Ø±Ø­", "Ø§Ù„ØªÙŠÙ†", "Ø§Ù„Ø¹Ù„Ù‚", "Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¨ÙŠÙ†Ø©", "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª", "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©", "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù‡Ù…Ø²Ø©", "Ø§Ù„ÙÙŠÙ„", "Ù‚Ø±ÙŠØ´", "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "Ø§Ù„ÙƒÙˆØ«Ø±", "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ù…Ø³Ø¯", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ù†Ø§Ø³"
        ];
        // Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª ÙƒÙ„ Ø³ÙˆØ±Ø© (Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚)
        const surahVersesCount = [0, 7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128, 111, 110, 98, 135, 112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83, 182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13, 14, 11, 11, 18, 12, 12, 30, 52, 52, 44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25, 22, 17, 19, 26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3, 6, 3, 5, 4, 5, 6];

        function getState() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {
                settings: { surah: 1, startVerse: 1, amountType: 'verses', amountValue: 5 },
                queue: [],
                currentReaderIndex: -1,
                isBookingStopped: false
            };
        }

        function saveState(state) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            updateDashboardUI(state);
        }

        function resetSession() {
            if(confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // --- ğŸ”¥ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¢ÙŠØ§Øª ÙˆØ§Ù„Ø³ÙˆØ± ğŸ”¥ ---
        function recalculateQueueVerses(state) {
            if (!state.queue) state.queue = [];
            if (!state.settings) state.settings = { surah: 1, startVerse: 1, amountType: 'verses', amountValue: 5 };

            // 1. ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ø­Ø³Ø§Ø¨
            let pointer = {
                surah: state.settings.surah,
                verse: state.settings.startVerse
            };

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù‚Ø§Ø±Ø¦Ø© Ø­Ø§Ù„ÙŠØ© (Ø£Ùˆ Ø§Ù†ØªÙ‡Øª)ØŒ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø­ÙŠØ« Ø§Ù†ØªÙ‡Øª Ù‡ÙŠ
            if (state.currentReaderIndex >= 0 && state.queue[state.currentReaderIndex]) {
                const currReader = state.queue[state.currentReaderIndex];
                const maxVerses = surahVersesCount[currReader.surahNum];
                
                // Ù‡Ù„ Ø®ØªÙ…Øª Ø§Ù„Ø³ÙˆØ±Ø©ØŸ
                if (currReader.endV >= maxVerses) {
                    pointer.surah = currReader.surahNum + 1; // Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                    pointer.verse = 1; // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³ÙˆØ±Ø©
                } else {
                    pointer.surah = currReader.surahNum; // Ù†ÙØ³ Ø§Ù„Ø³ÙˆØ±Ø©
                    pointer.verse = currReader.endV + 1; // Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                }
            }

            // 2. Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø±Ø¦Ø§Øª ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            for (let i = state.currentReaderIndex + 1; i < state.queue.length; i++) {
                // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù…ØµØ­Ù: Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø§Ø³ (114) Ù†Ø¹ÙˆØ¯ Ù„Ù„ÙØ§ØªØ­Ø© (1)
                if (pointer.surah > 114) pointer.surah = 1;

                const maxVerses = surahVersesCount[pointer.surah];
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ…ÙŠØ©
                let amount = 0;
                if (state.settings.amountType === 'verses') amount = parseInt(state.settings.amountValue);
                else if (state.settings.amountType === 'quarter') amount = 8;
                else if (state.settings.amountType === 'half') amount = 15;
                else if (state.settings.amountType === 'full') amount = 29;

                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
                let proposedEnd = pointer.verse + amount - 1;
                let actualEnd = proposedEnd;

                // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³ÙˆØ±Ø©
                if (proposedEnd >= maxVerses) {
                    actualEnd = maxVerses; // Ù†ØªÙˆÙ‚Ù Ø¹Ù†Ø¯ Ø¢Ø®Ø± Ø¢ÙŠØ©
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ØªÙŠ ØªÙ„ÙŠÙ‡Ø§ (Ù„ØªØ¨Ø¯Ø£ Ø³ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©)
                    var nextPointerSurah = pointer.surah + 1;
                    var nextPointerVerse = 1;
                } else {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ØªÙŠ ØªÙ„ÙŠÙ‡Ø§ (ØªÙƒÙ…Ù„ Ù†ÙØ³ Ø§Ù„Ø³ÙˆØ±Ø©)
                    var nextPointerSurah = pointer.surah;
                    var nextPointerVerse = actualEnd + 1;
                }

                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù‚Ø§Ø±Ø¦Ø©
                state.queue[i].surahNum = pointer.surah; // Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø±Ø¦Ø©
                state.queue[i].startV = pointer.verse;
                state.queue[i].endV = actualEnd;
                state.queue[i].verses = `Ù…Ù† ${pointer.verse} Ø¥Ù„Ù‰ ${actualEnd}`;

                // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                pointer.surah = nextPointerSurah;
                pointer.verse = nextPointerVerse;
            }
            return state;
        }

        function handleLogin() {
            const pass = document.getElementById('adminPass').value;
            if (pass === "1234") {
                document.getElementById('loginScreen').classList.add('hidden');
                const state = getState();
                if (state.queue && state.queue.length > 0) {
                    document.getElementById('dashboardScreen').classList.remove('hidden');
                    updateDashboardUI(state);
                } else {
                    document.getElementById('setupScreen').classList.remove('hidden');
                }
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
            }
        }

        function toggleAmountInput() {
            const val = document.getElementById('amountType').value;
            document.getElementById('amountValue').style.display = (val === 'verses') ? 'block' : 'none';
        }

        function handleStartSession() {
            const surah = document.getElementById('surahNum').value;
            const startV = document.getElementById('startVerse').value;
            const type = document.getElementById('amountType').value;
            const val = document.getElementById('amountValue').value || 5;
            
            const state = {
                settings: { surah: parseInt(surah), startVerse: parseInt(startV), amountType: type, amountValue: val },
                queue: [],
                currentReaderIndex: -1,
                isBookingStopped: false
            };
            saveState(state);
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');
        }

        function handleNextReader() {
            let state = getState();
            if (state.queue.length > state.currentReaderIndex + 1) {
                state.currentReaderIndex++;
                saveState(state); // Ø§Ù„Ø­ÙØ¸ Ø³ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¯Ù… Ù„Ùˆ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            } else {
                alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ø±Ø¦Ø§Øª ØªØ§Ù„ÙŠØ§Øª!");
            }
        }

        function handleToggleBooking() {
            let state = getState();
            state.isBookingStopped = !state.isBookingStopped;
            saveState(state);
        }

        function deleteReader(index) {
            let state = getState();
            state.queue.splice(index, 1);
            if (index < state.currentReaderIndex) state.currentReaderIndex--;
            else state = recalculateQueueVerses(state);
            saveState(state);
        }

        function makeUrgent(index) {
            let state = getState();
            if (index > state.currentReaderIndex + 1) {
                const reader = state.queue.splice(index, 1)[0]; 
                state.queue.splice(state.currentReaderIndex + 1, 0, reader);
                state = recalculateQueueVerses(state);
                saveState(state);
            }
        }

        function toggleTable() {
            document.getElementById('readersTableContainer').classList.toggle('hidden');
        }

        function updateDashboardUI(state) {
            if(!state) return;

            const btnStop = document.getElementById('stopBookingBtn');
            btnStop.innerText = state.isBookingStopped ? "ÙØªØ­ Ø§Ù„Ø­Ø¬Ø²" : "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø¬Ø²";
            btnStop.style.backgroundColor = state.isBookingStopped ? "#4CAF50" : "#d32f2f";

            const remaining = (state.queue ? state.queue.length : 0) - (state.currentReaderIndex + 1);
            document.getElementById('waitingCount').innerText = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining > 0 ? remaining : 0}`;

            if (state.queue && state.currentReaderIndex >= 0 && state.currentReaderIndex < state.queue.length) {
                const curr = state.queue[state.currentReaderIndex];
                // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø§
                const sName = surahNames[curr.surahNum] || "";
                document.getElementById('currentReaderDisplay').innerText = `ØªÙ‚Ø±Ø£ Ø§Ù„Ø¢Ù†: ${curr.name} - Ø³ÙˆØ±Ø© ${sName} (${curr.verses})`;
            } else {
                document.getElementById('currentReaderDisplay').innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡...";
            }

            const tbody = document.querySelector('#readersTable tbody');
            tbody.innerHTML = '';
            if(state.queue) {
                state.queue.forEach((reader, index) => {
                    if (index >= state.currentReaderIndex) {
                        const sName = surahNames[reader.surahNum] || "";
                        const row = `<tr>
                            <td>${reader.name}</td>
                            <td>${index + 1}</td>
                            <td><small>${sName}</small><br>${reader.verses}</td>
                            <td>
                                ${index > state.currentReaderIndex ? `<button class="btn-danger" style="padding:5px" onclick="deleteReader(${index})">Ø­Ø°Ù</button>` : 'Ø­Ø§Ù„ÙŠØ§Ù‹'}
                                ${index > state.currentReaderIndex + 1 ? `<button style="padding:5px" onclick="makeUrgent(${index})">Ù…Ø³ØªØ¹Ø¬Ù„Ø©</button>` : ''}
                            </td>
                        </tr>`;
                        tbody.innerHTML += row;
                    }
                });
            }
        }

        window.onload = function() {
            const surahSelect = document.getElementById('surahNum');
            for (let i = 1; i < surahNames.length; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.text = `${i}. ${surahNames[i]}`;
                surahSelect.appendChild(option);
            }
            surahSelect.value = 2; 

            window.addEventListener('storage', (e) => {
                if (e.key === STORAGE_KEY) {
                    updateDashboardUI(JSON.parse(e.newValue));
                }
            });
            updateDashboardUI(getState());
        };
    </script>
</body>
</html>
