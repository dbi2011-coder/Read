<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø±Ø£Ø© (Ø§Ù„Ù…Ø´Ø±ÙØ©)</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        .hidden { display: none !important; }
        .btn-reset { background-color: #607d8b; margin-top: 20px; font-size: 14px; padding: 10px; }
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .saving-indicator { position: fixed; top: 10px; left: 10px; background: #333; color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 12px; display: none; z-index: 9999;}
    </style>
</head>
<body>
    <div id="saving" class="saving-indicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</div>

    <div class="container" id="loginScreen">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙØ©</h2>
        <input type="password" id="adminPass" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (1234)">
        <button onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div class="container hidden" id="setupScreen">
        <h2>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©</h2>
        <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø© (Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©):</label>
        <select id="surahNum"></select>
        <label>Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø¢ÙŠØ©:</label>
        <input type="number" id="startVerse" value="1">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©:</label>
        <select id="amountType" onchange="toggleAmountInput()">
            <option value="verses">Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª Ù…Ø­Ø¯Ø¯</option>
            <option value="quarter">Ø±Ø¨Ø¹ ÙˆØ¬Ù‡</option>
            <option value="half">Ù†ØµÙ ÙˆØ¬Ù‡</option>
            <option value="full">ÙˆØ¬Ù‡ ÙƒØ§Ù…Ù„</option>
        </select>
        <input type="number" id="amountValue" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª">
        <button onclick="handleStartSession()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
    </div>

    <div class="container hidden" id="dashboardScreen">
        <div style="display: flex; justify-content: space-between;">
            <span id="waitingCount">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 0</span>
            <button class="btn-danger" id="stopBookingBtn" onclick="handleToggleBooking()">ØªØ­Ù…ÙŠÙ„...</button>
        </div>

        <button class="big-circle-btn" onclick="handleNextReader()">Ø§Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â©</button>
        
        <div id="currentReaderDisplay" style="margin: 20px 0; font-weight: bold; color: #00796b;">
            ...
        </div>

        <button class="btn-secondary" onclick="toggleTable()">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø±Ø¦Ø§Øª ğŸ“‹</button>
        
        <div id="readersTableContainer" class="hidden">
            <table id="readersTable">
                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ù…ÙˆØ¶Ø¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="btn-reset" onclick="resetSession()">ğŸ”„ Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase ---
        const SUPABASE_URL = 'https://imvcqsgaovkbocvswifx.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltdmNxc2dhb3ZrYm9jdnN3aWZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNzM0MDgsImV4cCI6MjA4Mjk0OTQwOH0.8hb29-fMG7eSkPod3u3X6mE_w5uVsz-Wm2zqmjgnOgg';
        
        // ğŸ”¥ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ø¥Ù„Ù‰ supabaseClient Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¶Ø§Ø±Ø¨ ğŸ”¥
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const surahNames = ["", "Ø§Ù„ÙØ§ØªØ­Ø©", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", "Ø§Ù„Ø£Ù†ÙØ§Ù„", "Ø§Ù„ØªÙˆØ¨Ø©", "ÙŠÙˆÙ†Ø³", "Ù‡ÙˆØ¯", "ÙŠÙˆØ³Ù", "Ø§Ù„Ø±Ø¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø§Ù„Ø­Ø¬Ø±", "Ø§Ù„Ù†Ø­Ù„", "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", "Ø§Ù„ÙƒÙ‡Ù", "Ù…Ø±ÙŠÙ…", "Ø·Ù‡", "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø­Ø¬", "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", "Ø§Ù„Ù†ÙˆØ±", "Ø§Ù„ÙØ±Ù‚Ø§Ù†", "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù…Ù„", "Ø§Ù„Ù‚ØµØµ", "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", "Ø§Ù„Ø±ÙˆÙ…", "Ù„Ù‚Ù…Ø§Ù†", "Ø§Ù„Ø³Ø¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨", "Ø³Ø¨Ø£", "ÙØ§Ø·Ø±", "ÙŠØ³", "Ø§Ù„ØµØ§ÙØ§Øª", "Øµ", "Ø§Ù„Ø²Ù…Ø±", "ØºØ§ÙØ±", "ÙØµÙ„Øª", "Ø§Ù„Ø´ÙˆØ±Ù‰", "Ø§Ù„Ø²Ø®Ø±Ù", "Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", "Ø§Ù„Ø£Ø­Ù‚Ø§Ù", "Ù…Ø­Ù…Ø¯", "Ø§Ù„ÙØªØ­", "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", "Ù‚", "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", "Ø§Ù„Ø·ÙˆØ±", "Ø§Ù„Ù†Ø¬Ù…", "Ø§Ù„Ù‚Ù…Ø±", "Ø§Ù„Ø±Ø­Ù…Ù†", "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ù„Ø­Ø¯ÙŠØ¯", "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", "Ø§Ù„Ø­Ø´Ø±", "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©", "Ø§Ù„ØµÙ", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", "Ø§Ù„ØªØºØ§Ø¨Ù†", "Ø§Ù„Ø·Ù„Ø§Ù‚", "Ø§Ù„ØªØ­Ø±ÙŠÙ…", "Ø§Ù„Ù…Ù„Ùƒ", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø­Ø§Ù‚Ø©", "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", "Ù†ÙˆØ­", "Ø§Ù„Ø¬Ù†", "Ø§Ù„Ù…Ø²Ù…Ù„", "Ø§Ù„Ù…Ø¯Ø«Ø±", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", "Ø§Ù„Ù†Ø¨Ø£", "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", "Ø¹Ø¨Ø³", "Ø§Ù„ØªÙƒÙˆÙŠØ±", "Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±", "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", "Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚", "Ø§Ù„Ø¨Ø±ÙˆØ¬", "Ø§Ù„Ø·Ø§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºØ§Ø´ÙŠØ©", "Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¨Ù„Ø¯", "Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø¶Ø­Ù‰", "Ø§Ù„Ø´Ø±Ø­", "Ø§Ù„ØªÙŠÙ†", "Ø§Ù„Ø¹Ù„Ù‚", "Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¨ÙŠÙ†Ø©", "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª", "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©", "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù‡Ù…Ø²Ø©", "Ø§Ù„ÙÙŠÙ„", "Ù‚Ø±ÙŠØ´", "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "Ø§Ù„ÙƒÙˆØ«Ø±", "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ù…Ø³Ø¯", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ù†Ø§Ø³"];
        const surahVersesCount = [0, 7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128, 111, 110, 98, 135, 112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83, 182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13, 14, 11, 11, 18, 12, 12, 30, 52, 52, 44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25, 22, 17, 19, 26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3, 6, 3, 5, 4, 5, 6];

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ---
        async function getState() {
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            let { data, error } = await supabaseClient.from('session_state').select('data').eq('id', 1).single();
            if (error) { console.error("Error fetching state:", error); return null; }
            return data ? data.data : null;
        }

        async function saveState(state) {
            document.getElementById('saving').style.display = 'block';
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const { error } = await supabaseClient.from('session_state').update({ data: state }).eq('id', 1);
            document.getElementById('saving').style.display = 'none';
            if (error) alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
        }

        async function resetSession() {
            if(confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.")) {
                const newState = {
                    settings: { surah: 1, startVerse: 1, amountType: 'verses', amountValue: 5 },
                    queue: [], currentReaderIndex: -1, isBookingStopped: false
                };
                await saveState(newState);
                location.reload();
            }
        }

        // --- Ø§Ù„Ù…Ù†Ø·Ù‚ (Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©) ---
        function recalculateQueueVerses(state) {
            if (!state.queue) state.queue = [];
            if (!state.settings) state.settings = { surah: 1, startVerse: 1, amountType: 'verses', amountValue: 5 };

            let pointer = { surah: state.settings.surah, verse: state.settings.startVerse };

            if (state.currentReaderIndex >= 0 && state.queue[state.currentReaderIndex]) {
                const currReader = state.queue[state.currentReaderIndex];
                const maxVerses = surahVersesCount[currReader.surahNum];
                if (currReader.endV >= maxVerses) {
                    pointer.surah = currReader.surahNum + 1;
                    pointer.verse = 1;
                } else {
                    pointer.surah = currReader.surahNum;
                    pointer.verse = currReader.endV + 1;
                }
            }

            for (let i = state.currentReaderIndex + 1; i < state.queue.length; i++) {
                if (pointer.surah > 114) pointer.surah = 1;
                const maxVerses = surahVersesCount[pointer.surah];
                
                let amount = 0;
                if (state.settings.amountType === 'verses') amount = parseInt(state.settings.amountValue);
                else if (state.settings.amountType === 'quarter') amount = 8;
                else if (state.settings.amountType === 'half') amount = 15;
                else if (state.settings.amountType === 'full') amount = 29;

                let proposedEnd = pointer.verse + amount - 1;
                let actualEnd = proposedEnd;
                let nextPointerSurah, nextPointerVerse;

                if (proposedEnd >= maxVerses) {
                    actualEnd = maxVerses;
                    nextPointerSurah = pointer.surah + 1;
                    nextPointerVerse = 1;
                } else {
                    nextPointerSurah = pointer.surah;
                    nextPointerVerse = actualEnd + 1;
                }

                state.queue[i].surahNum = pointer.surah;
                state.queue[i].startV = pointer.verse;
                state.queue[i].endV = actualEnd;
                state.queue[i].verses = `Ù…Ù† ${pointer.verse} Ø¥Ù„Ù‰ ${actualEnd}`;

                pointer.surah = nextPointerSurah;
                pointer.verse = nextPointerVerse;
            }
            return state;
        }

        async function handleLogin() {
            const pass = document.getElementById('adminPass').value;
            if (pass === "1234") {
                document.getElementById('loginScreen').classList.add('hidden');
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
                try {
                    const state = await getState();
                    if (state && state.queue && state.queue.length > 0) {
                        document.getElementById('dashboardScreen').classList.remove('hidden');
                        updateDashboardUI(state);
                    } else {
                        document.getElementById('setupScreen').classList.remove('hidden');
                    }
                } catch (e) {
                    console.error(e);
                    // ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±ØºØ§Ù‹ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
                    document.getElementById('setupScreen').classList.remove('hidden');
                }

            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
            }
        }

        function toggleAmountInput() {
            const val = document.getElementById('amountType').value;
            document.getElementById('amountValue').style.display = (val === 'verses') ? 'block' : 'none';
        }

        async function handleStartSession() {
            const surah = document.getElementById('surahNum').value;
            const startV = document.getElementById('startVerse').value;
            const type = document.getElementById('amountType').value;
            const val = document.getElementById('amountValue').value || 5;
            
            const state = {
                settings: { surah: parseInt(surah), startVerse: parseInt(startV), amountType: type, amountValue: val },
                queue: [], currentReaderIndex: -1, isBookingStopped: false
            };
            await saveState(state);
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');
        }

        async function handleNextReader() {
            let state = await getState();
            if (state && state.queue && state.queue.length > state.currentReaderIndex + 1) {
                state.currentReaderIndex++;
                await saveState(state);
            } else {
                alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø§Ø±Ø¦Ø§Øª ØªØ§Ù„ÙŠØ§Øª!");
            }
        }

        async function handleToggleBooking() {
            let state = await getState();
            state.isBookingStopped = !state.isBookingStopped;
            await saveState(state);
        }

        async function deleteReader(index) {
            let state = await getState();
            state.queue.splice(index, 1);
            if (index < state.currentReaderIndex) state.currentReaderIndex--;
            else state = recalculateQueueVerses(state);
            await saveState(state);
        }

        async function makeUrgent(index) {
            let state = await getState();
            if (index > state.currentReaderIndex + 1) {
                const reader = state.queue.splice(index, 1)[0]; 
                state.queue.splice(state.currentReaderIndex + 1, 0, reader);
                state = recalculateQueueVerses(state);
                await saveState(state);
            }
        }

        function toggleTable() {
            document.getElementById('readersTableContainer').classList.toggle('hidden');
        }

        function updateDashboardUI(state) {
            if(!state) return;
            const btnStop = document.getElementById('stopBookingBtn');
            btnStop.innerText = state.isBookingStopped ? "ÙØªØ­ Ø§Ù„Ø­Ø¬Ø²" : "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø¬Ø²";
            btnStop.style.backgroundColor = state.isBookingStopped ? "#4CAF50" : "#d32f2f";

            const remaining = (state.queue ? state.queue.length : 0) - (state.currentReaderIndex + 1);
            document.getElementById('waitingCount').innerText = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining > 0 ? remaining : 0}`;

            if (state.queue && state.currentReaderIndex >= 0 && state.currentReaderIndex < state.queue.length) {
                const curr = state.queue[state.currentReaderIndex];
                const sName = surahNames[curr.surahNum] || "";
                document.getElementById('currentReaderDisplay').innerText = `ØªÙ‚Ø±Ø£ Ø§Ù„Ø¢Ù†: ${curr.name} - Ø³ÙˆØ±Ø© ${sName} (${curr.verses})`;
            } else {
                document.getElementById('currentReaderDisplay').innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡...";
            }

            const tbody = document.querySelector('#readersTable tbody');
            tbody.innerHTML = '';
            if(state.queue) {
                state.queue.forEach((reader, index) => {
                    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ù† ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø¢Ù† ÙˆÙ…Ù† ÙŠÙ„ÙŠÙ‡
                    if (index >= state.currentReaderIndex) {
                        const sName = surahNames[reader.surahNum] || "";
                        const row = `<tr>
                            <td>${reader.name}</td>
                            <td>${index + 1}</td>
                            <td><small>${sName}</small><br>${reader.verses}</td>
                            <td>
                                ${index > state.currentReaderIndex ? `<button class="btn-danger" style="padding:5px" onclick="deleteReader(${index})">Ø­Ø°Ù</button>` : 'Ø­Ø§Ù„ÙŠØ§Ù‹'}
                                ${index > state.currentReaderIndex + 1 ? `<button style="padding:5px" onclick="makeUrgent(${index})">Ù…Ø³ØªØ¹Ø¬Ù„Ø©</button>` : ''}
                            </td>
                        </tr>`;
                        tbody.innerHTML += row;
                    }
                });
            }
        }

        window.onload = async function() {
            const surahSelect = document.getElementById('surahNum');
            for (let i = 1; i < surahNames.length; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.text = `${i}. ${surahNames[i]}`;
                surahSelect.appendChild(option);
            }
            surahSelect.value = 2; 

            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø­ÙŠØ© Ù…Ù† Supabase
            // Ù†Ø³ØªØ®Ø¯Ù… supabaseClient Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹
            const channel = supabaseClient.channel('public:session_state')
                .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'session_state', filter: 'id=eq.1' }, payload => {
                    updateDashboardUI(payload.new.data);
                })
                .subscribe();

            // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
            const initialState = await getState();
            if(initialState) updateDashboardUI(initialState);
        };
    </script>
</body>
</html>
