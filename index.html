<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù‚Ø±Ø£Ø© Ø§Ù„ØªÙ„Ø§ÙˆØ©</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">
    
    <style>
        .hidden { display: none !important; }
        .quran-container { background-color: #fffbf2; padding: 25px; border-radius: 15px; border: 2px solid #d4af37; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 25px; text-align: center; margin-top: 20px; }
        .quran-header { color: #d4af37; font-family: 'Amiri Quran', serif; font-size: 22px; margin-bottom: 10px; border-bottom: 1px solid #ebd598; padding-bottom: 10px; }
        .quran-text { font-family: 'Amiri Quran', serif; font-size: 26px; line-height: 2.4; color: #000; direction: rtl; margin-bottom: 20px; text-align: justify; margin-top: 15px; }
        .basmala { font-family: 'Amiri Quran', serif; font-size: 22px; color: #555; margin-bottom: 20px; display: block; width: 100%; text-align: center; }
        .ayah-symbol { color: #d4af37; font-size: 24px; margin: 0 5px; display: inline-block; }
        .status-box { padding: 20px; border-radius: 15px; margin-top: 10px; transition: all 0.5s ease; }
        .audio-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 10px 0; padding-bottom: 15px; border-bottom: 1px dashed #d4af37; }
        .btn-audio { background-color: #00796b; color: #fff; border: none; padding: 10px 20px; border-radius: 25px; font-size: 16px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.3s; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
        .btn-audio:hover { background-color: #004d40; }
        .playing { background-color: #c62828 !important; }
        .loader { color: #888; font-size: 14px; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="container" id="bookingScreen">
        <h1>Ø­Ø¬Ø² Ø¯ÙˆØ± Ù„Ù„ØªÙ„Ø§ÙˆØ© ğŸ“–</h1>
        <p style="color: #666; margin-bottom: 20px;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¬Ø² Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†</p>
        <input type="text" id="readerName" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <button class="big-circle-btn" onclick="handleBook()">Ø­Ø¬Ø² Ø¯ÙˆØ±</button>
        <p id="errorMsg" style="color: red;"></p>
    </div>

    <div class="container hidden" id="statusScreen">
        <h2 id="welcomeName" style="color: #00796b; margin-bottom: 10px;">...</h2>
        <div id="roleBox" class="status-box waiting">
            <h1 id="statusText" style="margin: 10px 0;">...</h1>
            <p id="subStatus" style="font-size: 16px;">...</p>
        </div>
        <div class="quran-container">
            <div id="surahTitle" class="quran-header">...</div>
            <div class="audio-controls hidden" id="audioControls">
                <button class="btn-audio" id="playBtn" onclick="toggleAudio()"><span>ğŸ”Š</span> Ø§Ø³ØªÙ…Ø§Ø¹ (Ø§Ù„Ø´ÙŠØ® Ø§Ù„Ø­ØµØ±ÙŠ)</button>
                <div id="audioStatus" style="font-size: 14px; color: #555;"></div>
            </div>
            <div id="quranLoading" class="loader hidden">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¢ÙŠØ§Øª...</div>
            <div id="quranTextDisplay" class="quran-text"></div>
        </div>
        <button onclick="location.reload()" style="background:none; color:#999; border:none; margin-top:10px; font-size:12px; box-shadow:none;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
    <audio id="audioPlayer"></audio>

    <script>
        const STORAGE_KEY = 'quran_queue_offline_v3';
        let myId = null;
        let audioPlaylist = []; 
        let currentAudioIndex = 0;
        let isPlaying = false;
        let lastVersesHash = ""; 
        let lastStatus = ""; 

        const surahNames = ["", "Ø§Ù„ÙØ§ØªØ­Ø©", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", "Ø§Ù„Ø£Ù†ÙØ§Ù„", "Ø§Ù„ØªÙˆØ¨Ø©", "ÙŠÙˆÙ†Ø³", "Ù‡ÙˆØ¯", "ÙŠÙˆØ³Ù", "Ø§Ù„Ø±Ø¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø§Ù„Ø­Ø¬Ø±", "Ø§Ù„Ù†Ø­Ù„", "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", "Ø§Ù„ÙƒÙ‡Ù", "Ù…Ø±ÙŠÙ…", "Ø·Ù‡", "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø­Ø¬", "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", "Ø§Ù„Ù†ÙˆØ±", "Ø§Ù„ÙØ±Ù‚Ø§Ù†", "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù…Ù„", "Ø§Ù„Ù‚ØµØµ", "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", "Ø§Ù„Ø±ÙˆÙ…", "Ù„Ù‚Ù…Ø§Ù†", "Ø§Ù„Ø³Ø¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨", "Ø³Ø¨Ø£", "ÙØ§Ø·Ø±", "ÙŠØ³", "Ø§Ù„ØµØ§ÙØ§Øª", "Øµ", "Ø§Ù„Ø²Ù…Ø±", "ØºØ§ÙØ±", "ÙØµÙ„Øª", "Ø§Ù„Ø´ÙˆØ±Ù‰", "Ø§Ù„Ø²Ø®Ø±Ù", "Ø§Ù„Ø¯Ø®Ø§Ù†", "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", "Ø§Ù„Ø£Ø­Ù‚Ø§Ù", "Ù…Ø­Ù…Ø¯", "Ø§Ù„ÙØªØ­", "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", "Ù‚", "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", "Ø§Ù„Ø·ÙˆØ±", "Ø§Ù„Ù†Ø¬Ù…", "Ø§Ù„Ù‚Ù…Ø±", "Ø§Ù„Ø±Ø­Ù…Ù†", "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ù„Ø­Ø¯ÙŠØ¯", "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", "Ø§Ù„Ø­Ø´Ø±", "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©", "Ø§Ù„ØµÙ", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", "Ø§Ù„ØªØºØ§Ø¨Ù†", "Ø§Ù„Ø·Ù„Ø§Ù‚", "Ø§Ù„ØªØ­Ø±ÙŠÙ…", "Ø§Ù„Ù…Ù„Ùƒ", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø­Ø§Ù‚Ø©", "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", "Ù†ÙˆØ­", "Ø§Ù„Ø¬Ù†", "Ø§Ù„Ù…Ø²Ù…Ù„", "Ø§Ù„Ù…Ø¯Ø«Ø±", "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", "Ø§Ù„Ù†Ø¨Ø£", "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", "Ø¹Ø¨Ø³", "Ø§Ù„ØªÙƒÙˆÙŠØ±", "Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±", "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", "Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚", "Ø§Ù„Ø¨Ø±ÙˆØ¬", "Ø§Ù„Ø·Ø§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºØ§Ø´ÙŠØ©", "Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¨Ù„Ø¯", "Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù„ÙŠÙ„", "Ø§Ù„Ø¶Ø­Ù‰", "Ø§Ù„Ø´Ø±Ø­", "Ø§Ù„ØªÙŠÙ†", "Ø§Ù„Ø¹Ù„Ù‚", "Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¨ÙŠÙ†Ø©", "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª", "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©", "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù‡Ù…Ø²Ø©", "Ø§Ù„ÙÙŠÙ„", "Ù‚Ø±ÙŠØ´", "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", "Ø§Ù„ÙƒÙˆØ«Ø±", "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ù…Ø³Ø¯", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ù†Ø§Ø³"];
        const surahVersesCount = [0, 7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128, 111, 110, 98, 135, 112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83, 182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13, 14, 11, 11, 18, 12, 12, 30, 52, 52, 44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25, 22, 17, 19, 26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3, 6, 3, 5, 4, 5, 6];

        function getState() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : { settings: {surah: 1}, queue: [], currentReaderIndex: -1, isBookingStopped: false };
        }

        function saveState(state) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        // Ù†ÙØ³ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø´Ø±ÙØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚
        function recalculateQueueVerses(state) {
            if (!state.queue) state.queue = [];
            if (!state.settings) state.settings = { surah: 1, startVerse: 1, amountType: 'verses', amountValue: 5 };

            let pointer = {
                surah: state.settings.surah,
                verse: state.settings.startVerse
            };

            if (state.currentReaderIndex >= 0 && state.queue[state.currentReaderIndex]) {
                const currReader = state.queue[state.currentReaderIndex];
                const maxVerses = surahVersesCount[currReader.surahNum];
                if (currReader.endV >= maxVerses) {
                    pointer.surah = currReader.surahNum + 1;
                    pointer.verse = 1;
                } else {
                    pointer.surah = currReader.surahNum;
                    pointer.verse = currReader.endV + 1;
                }
            }

            for (let i = state.currentReaderIndex + 1; i < state.queue.length; i++) {
                if (pointer.surah > 114) pointer.surah = 1;
                const maxVerses = surahVersesCount[pointer.surah];
                let amount = 0;
                if (state.settings.amountType === 'verses') amount = parseInt(state.settings.amountValue);
                else if (state.settings.amountType === 'quarter') amount = 8;
                else if (state.settings.amountType === 'half') amount = 15;
                else if (state.settings.amountType === 'full') amount = 29;

                let proposedEnd = pointer.verse + amount - 1;
                let actualEnd = proposedEnd;

                if (proposedEnd >= maxVerses) {
                    actualEnd = maxVerses;
                    var nextPointerSurah = pointer.surah + 1;
                    var nextPointerVerse = 1;
                } else {
                    var nextPointerSurah = pointer.surah;
                    var nextPointerVerse = actualEnd + 1;
                }

                state.queue[i].surahNum = pointer.surah;
                state.queue[i].startV = pointer.verse;
                state.queue[i].endV = actualEnd;
                state.queue[i].verses = `Ù…Ù† ${pointer.verse} Ø¥Ù„Ù‰ ${actualEnd}`;

                pointer.surah = nextPointerSurah;
                pointer.verse = nextPointerVerse;
            }
            return state;
        }

        function handleBook() {
            let state = getState();
            if (state.isBookingStopped) {
                document.getElementById('errorMsg').innerText = "Ù†Ø¹ØªØ°Ø± Ù…Ù†ÙƒØŒ Ø§Ù„Ø­Ø¬Ø² Ù…ØªÙˆÙ‚Ù Ø­Ø§Ù„ÙŠØ§Ù‹.";
                return;
            }
            const nameInput = document.getElementById('readerName');
            let name = nameInput.value.trim();
            if (!name) name = `Ù‚Ø§Ø±Ø¦Ø© ${(state.queue ? state.queue.length : 0) + 1}`;
            if (!state.queue) state.queue = [];
            
            // ØªÙ‡ÙŠØ¦Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ©
            const newReader = { id: Date.now(), name: name, verses: "...", surahNum: 1, startV: 0, endV: 0 };
            state.queue.push(newReader);
            state = recalculateQueueVerses(state); // Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ù„Ø¢ÙŠØ§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
            saveState(state);

            myId = newReader.id;
            document.getElementById('bookingScreen').classList.add('hidden');
            document.getElementById('statusScreen').classList.remove('hidden');
            document.getElementById('welcomeName').innerText = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ: ${name}`;
            updateUserUI(state);
        }

        async function fetchQuranData(surahNum, startV, endV) {
            const displayDiv = document.getElementById('quranTextDisplay');
            const loadingDiv = document.getElementById('quranLoading');
            const audioDiv = document.getElementById('audioControls');
            loadingDiv.classList.remove('hidden');
            displayDiv.innerHTML = '';
            audioDiv.classList.add('hidden');

            try {
                if (!surahNum || startV <= 0 || endV < startV) throw new Error("Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¢ÙŠØ§Øª ØºÙŠØ± ØµØ­ÙŠØ­");
                const limit = endV - startV + 1;
                const offset = startV - 1; 
                const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNum}/quran-uthmani?offset=${offset}&limit=${limit}`);
                if(!response.ok) throw new Error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…ØµØ¯Ø±");
                const data = await response.json();

                if(data.code === 200 && data.data && Array.isArray(data.data.ayahs)) {
                    const ayahs = data.data.ayahs;
                    let fullText = "";
                    audioPlaylist = [];
                    currentAudioIndex = 0;

                    if(startV === 1 && surahNum !== 1 && surahNum !== 9) {
                        displayDiv.innerHTML += '<div class="basmala">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù</div>';
                    }

                    ayahs.forEach(ayah => {
                        let text = ayah.text;
                        if(surahNum !== 1 && startV === 1 && ayah.numberInSurah === 1) {
                             text = text.replace("Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„Ù‘ÙÙ‡Ù Ù±Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù", "").trim();
                        }
                        fullText += `<span>${text} <span class="ayah-symbol">Û</span> </span>`;
                        const sID = String(surahNum).padStart(3, '0');
                        const vID = String(ayah.numberInSurah).padStart(3, '0');
                        audioPlaylist.push(`https://everyayah.com/data/Husary_128kbps/${sID}${vID}.mp3`);
                    });

                    displayDiv.innerHTML += fullText;
                    loadingDiv.classList.add('hidden');
                    audioDiv.classList.remove('hidden');
                } else {
                    throw new Error("ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆØ§ÙÙ‚");
                }
            } catch (error) {
                loadingDiv.classList.add('hidden');
                displayDiv.innerHTML = `<div style="color:#d32f2f; font-size:16px; padding:10px;">âš ï¸ ØªØ¹Ø°Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.<br><small>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ù…ØµØ­Ù (Ù…Ù† Ø¢ÙŠØ© ${startV} Ø¥Ù„Ù‰ ${endV})</small></div>`;
                console.error("Fetch Error:", error);
            }
        }

        function toggleAudio() {
            const player = document.getElementById('audioPlayer');
            const btn = document.getElementById('playBtn');
            const status = document.getElementById('audioStatus');
            if (isPlaying) {
                player.pause();
                isPlaying = false;
                btn.innerHTML = '<span>ğŸ”Š</span> Ø§Ø³ØªÙ…Ø±Ø§Ø±';
                btn.classList.remove('playing');
            } else {
                if(audioPlaylist.length > 0) {
                    if(!player.src || player.ended) player.src = audioPlaylist[currentAudioIndex];
                    player.play();
                    isPlaying = true;
                    btn.innerHTML = '<span>â¸</span> Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
                    btn.classList.add('playing');
                    status.innerText = `ØªÙ„Ø§ÙˆØ© Ø¢ÙŠØ© ${currentAudioIndex + 1}`;
                }
            }
        }

        document.getElementById('audioPlayer').onended = function() {
            currentAudioIndex++;
            if (currentAudioIndex < audioPlaylist.length) {
                this.src = audioPlaylist[currentAudioIndex];
                this.play();
                document.getElementById('audioStatus').innerText = `ØªÙ„Ø§ÙˆØ© Ø¢ÙŠØ© ${currentAudioIndex + 1}`;
            } else {
                isPlaying = false;
                document.getElementById('playBtn').innerHTML = '<span>ğŸ”Š</span> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹';
                document.getElementById('playBtn').classList.remove('playing');
                document.getElementById('audioStatus').innerText = "Ø§Ù†ØªÙ‡Øª Ø§Ù„ØªÙ„Ø§ÙˆØ©";
                currentAudioIndex = 0;
            }
        };

        function updateUserUI(state) {
            if (!myId) return; 
            const myReader = state.queue ? state.queue.find(r => r.id === myId) : null;
            const myIndex = state.queue ? state.queue.findIndex(r => r.id === myId) : -1;
            const currentIndex = state.currentReaderIndex;

            if (!myReader) {
                if (!document.getElementById('statusScreen').classList.contains('hidden')) {
                    alert("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø².");
                    location.reload();
                }
                return;
            }

            const sName = surahNames[myReader.surahNum] || "Ù…Ø®ØªØ§Ø±Ø©";
            document.getElementById('surahTitle').innerText = `Ø³ÙˆØ±Ø© ${sName} - ${myReader.verses}`;

            const currentHash = `${myReader.surahNum}-${myReader.startV}-${myReader.endV}`;
            if (currentHash !== lastVersesHash) {
                lastVersesHash = currentHash;
                fetchQuranData(myReader.surahNum, myReader.startV, myReader.endV);
            }

            if (myIndex < currentIndex && myIndex !== -1) {
                alert("Ø§Ù†ØªÙ‡Ù‰ Ø¯ÙˆØ±ÙƒØŒ ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ùƒ!");
                location.reload();
                return;
            }

            const roleBox = document.getElementById('roleBox');
            const statusText = document.getElementById('statusText');
            const subStatus = document.getElementById('subStatus');
            const diff = myIndex - currentIndex;

            roleBox.classList.remove('waiting', 'ready', 'active');
            let currentStatus = ""; 

            if (diff === 0) {
                currentStatus = "active";
                roleBox.classList.add('active');
                statusText.innerText = "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù† ğŸ¤";
                subStatus.innerText = "ØªÙØ¶Ù„ÙŠ Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©";
                if (lastStatus !== "active") {
                    if (navigator.vibrate) navigator.vibrate([500, 200, 500]);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } else if (diff === 1) {
                currentStatus = "ready";
                roleBox.classList.add('ready');
                if (currentIndex === -1) {
                    statusText.innerText = "Ø£Ù†ØªÙ Ø§Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰";
                    subStatus.innerText = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´Ø±ÙØ© Ù„Ù„Ø¬Ù„Ø³Ø©...";
                } else {
                    statusText.innerText = "Ø§Ø³ØªØ¹Ø¯ÙŠ..";
                    subStatus.innerText = "Ø£Ù†ØªÙ Ø§Ù„Ù‚Ø§Ø±Ø¦Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©";
                }
            } else {
                currentStatus = "waiting";
                roleBox.classList.add('waiting');
                statusText.innerText = "Ø§Ù†ØªØ¸Ø§Ø±";
                subStatus.innerText = `ÙŠØ³Ø¨Ù‚Ùƒ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${diff - 1} Ù‚Ø§Ø±Ø¦Ø§Øª`;
            }
            lastStatus = currentStatus;
        }

        window.onload = function() {
            window.addEventListener('storage', (e) => {
                if (e.key === STORAGE_KEY) updateUserUI(JSON.parse(e.newValue));
            });
        };
    </script>
</body>
</html>
